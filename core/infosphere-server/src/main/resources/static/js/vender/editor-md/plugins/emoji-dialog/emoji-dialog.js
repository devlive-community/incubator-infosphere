/*!
 * Emoji dialog plugin for Editor.md
 *
 * @file        emoji-dialog.js
 * @author      pandao
 * @version     1.2.0
 * @updateTime  2015-03-08
 * {@link       https://github.com/pandao/editor.md}
 * @license     MIT
 */
(function(){var a=function(b){var h=jQuery;var g="emoji-dialog";var f=0;var e=[];var c=[];var d={"zh-cn":{toolbar:{emoji:"Emoji 表情"},dialog:{emoji:{title:"Emoji 表情"}}}};b.fn.emojiDialog=function(){var z=this;var s=this.cm;var E=z.settings;if(!E.emoji){alert("settings.emoji == false");return}var w=E.pluginPath+g+"/";var l=this.editor;var m=s.getCursor();var G=s.getSelection();var k=this.classPrefix;h.extend(true,this.lang,d[this.lang.name]);this.setToolbar();var H=this.lang;var p=k+g,D;var o=H.dialog.emoji;var r=['<div class="'+k+'emoji-dialog-box" style="width: 760px;height: 334px;margin-bottom: 8px;overflow: hidden;">','<div class="'+k+'tab"></div>',"</div>"].join("\n");s.focus();if(l.find("."+p).length>0){D=l.find("."+p);c=[];D.find("a").removeClass("selected");this.dialogShowMask(D);this.dialogLockScreen();D.show()}else{D=this.createDialog({name:p,title:o.title,width:800,height:475,mask:E.dialogShowMask,drag:E.dialogDraggable,content:r,lockScreen:E.dialogLockScreen,maskStyle:{opacity:E.dialogMaskOpacity,backgroundColor:E.dialogMaskBgColor},buttons:{enter:[H.buttons.enter,function(){s.replaceSelection(c.join(" "));this.hide().lockScreen(false).hideMask();return false}],cancel:[H.buttons.cancel,function(){this.hide().lockScreen(false).hideMask();return false}]}})}var y=["Github emoji","Twemoji","Font awesome"];var j=D.find("."+k+"tab");if(j.html()===""){var n='<ul class="'+k+'tab-head">';for(var C=0;C<y.length;C++){var q=(C===0)?' class="active"':"";n+="<li"+q+'><a href="javascript:;">'+y[C]+"</a></li>"}n+="</ul>";j.append(n);var v='<div class="'+k+'tab-container">';for(var u=0;u<4;u++){var B=(u===0)?"":"display:none;";v+='<div class="'+k+'tab-box" style="height: 260px;overflow: hidden;overflow-y: auto;'+B+'"></div>'}v+="</div>";j.append(v)}var t=j.find("."+k+"tab-box");var A=["github-emoji","twemoji","font-awesome"];var F=function(){var L=A[f];var K=e[L];var N=t.eq(f);if(N.html()!==""){return}var J=function(Q,W){var U=(W==="editormd-logo")?"5":20;var S=Math.ceil(Q.length/U);var Z='<div class="'+k+'grid-table">';for(var R=0;R<S;R++){var aa='<div class="'+k+'grid-table-row">';for(var Y=0;Y<U;Y++){var T=h.trim(Q[(R*U)+Y]);if(typeof T!=="undefined"&&T!==""){var P="",X="";if(W==="github-emoji"){var O=(T==="+1")?"plus1":T;O=(O==="black_large_square")?"black_square":O;O=(O==="moon")?"waxing_gibbous_moon":O;O=b.emoji.path+O+b.emoji.ext;P='<img src="'+O+'" width="24" class="emoji" title="&#58;'+T+'&#58;" alt="&#58;'+T+'&#58;" />';aa+='<a href="javascript:;" value=":'+T+':" title=":'+T+':" class="'+k+'emoji-btn">'+P+"</a>"}else{if(W==="twemoji"){var V=b.twemoji.path+T+b.twemoji.ext;P='<img src="'+V+'" width="24" title="twemoji-'+T+'" alt="twemoji-'+T+'" class="emoji twemoji" />';aa+='<a href="javascript:;" value=":tw-'+T+':" title=":tw-'+T+':" class="'+k+'emoji-btn">'+P+"</a>"}else{if(W==="font-awesome"){X='<i class="fa fa-'+T+' fa-emoji" title="'+T+'"></i>';aa+='<a href="javascript:;" value=":fa-'+T+':" title=":fa-'+T+':" class="'+k+'emoji-btn">'+X+"</a>"}}}}else{aa+='<a href="javascript:;" value=""></a>'}}aa+="</div>";Z+=aa}Z+="</div>";return Z};if(f===0){for(var M=0,I=K.length;M<I;M++){var x=(M===0)?' style="margin: 0 0 10px;"':' style="margin: 10px 0;"';N.append("<h4"+x+">"+K[M].category+"</h4>");N.append(J(K[M].list,L))}}else{N.append(J(K,L))}N.find("."+k+"emoji-btn").bind(b.mouseOrTouch("click","touchend"),function(){h(this).toggleClass("selected");if(h(this).hasClass("selected")){c.push(h(this).attr("value"))}})};if(e.length<1){if(typeof D.loading==="function"){D.loading(true)}h.getJSON(w+"emoji.json?temp="+Math.random(),function(i){if(typeof D.loading==="function"){D.loading(false)}e=i;F()})}else{F()}j.find("li").bind(b.mouseOrTouch("click","touchend"),function(){var i=h(this);f=i.index();i.addClass("active").siblings().removeClass("active");t.eq(f).show().siblings().hide();F()})}};if(typeof require==="function"&&typeof exports==="object"&&typeof module==="object"){module.exports=a}else{if(typeof define==="function"){if(define.amd){define(["editormd"],function(b){a(b)})}else{define(function(c){var b=c("./../../editormd");a(b)})}}else{a(window.editormd)}}})();