(function(b){if(typeof exports=="object"&&typeof module=="object"){b(require("../../lib/codemirror"))}else{if(typeof define=="function"&&define.amd){define(["../../lib/codemirror"],b)}else{b(CodeMirror)}}})(function(b){b.defineMode("stex",function(){function l(d,c){d.cmdState.push(c)}function n(c){if(c.cmdState.length>0){return c.cmdState[c.cmdState.length-1]}else{return null}}function a(c){var d=c.cmdState.pop();if(d){d.closeBracket()}}function t(e){var f=e.cmdState;for(var c=f.length-1;c>=0;c--){var d=f[c];if(d.name=="DEFAULT"){continue}return d}return{styleIdentifier:function(){return null}}}function s(e,c,d){return function(){this.name=e;this.bracketNo=0;this.style=c;this.styles=d;this.argument=null;this.styleIdentifier=function(){return this.styles[this.bracketNo-1]||null};this.openBracket=function(){this.bracketNo++;return"bracket"};this.closeBracket=function(){}}}var r={};r.importmodule=s("importmodule","tag",["string","builtin"]);r.documentclass=s("documentclass","tag",["","atom"]);r.usepackage=s("usepackage","tag",["atom"]);r.begin=s("begin","tag",["atom"]);r.end=s("end","tag",["atom"]);r.DEFAULT=function(){this.name="DEFAULT";this.style="tag";this.styleIdentifier=this.openBracket=this.closeBracket=function(){}};function q(c,d){c.f=d}function p(e,f){var d;if(e.match(/^\\[a-zA-Z@]+/)){var c=e.current().slice(1);d=r[c]||r.DEFAULT;d=new d();l(f,d);q(f,o);return d.style}if(e.match(/^\\[$&%#{}_]/)){return"tag"}if(e.match(/^\\[,;!\/\\]/)){return"tag"}if(e.match("\\[")){q(f,function(h,i){return m(h,i,"\\]")});return"keyword"}if(e.match("$$")){q(f,function(h,i){return m(h,i,"$$")});return"keyword"}if(e.match("$")){q(f,function(h,i){return m(h,i,"$")});return"keyword"}var g=e.next();if(g=="%"){e.skipToEnd();return"comment"}else{if(g=="}"||g=="]"){d=n(f);if(d){d.closeBracket(g);q(f,o)}else{return"error"}return"bracket"}else{if(g=="{"||g=="["){d=r.DEFAULT;d=new d();l(f,d);return"bracket"}else{if(/\d/.test(g)){e.eatWhile(/[\w.%]/);return"atom"}else{e.eatWhile(/[\w\-_]/);d=t(f);if(d.name=="begin"){d.argument=e.current()}return d.styleIdentifier()}}}}}function m(f,c,e){if(f.eatSpace()){return null}if(f.match(e)){q(c,p);return"keyword"}if(f.match(/^\\[a-zA-Z@]+/)){return"tag"}if(f.match(/^[a-zA-Z]+/)){return"variable-2"}if(f.match(/^\\[$&%#{}_]/)){return"tag"}if(f.match(/^\\[,;!\/]/)){return"tag"}if(f.match(/^[\^_&]/)){return"tag"}if(f.match(/^[+\-<>|=,\/@!*:;'"`~#?]/)){return null}if(f.match(/^(\d+\.\d*|\d*\.\d+|\d+)/)){return"number"}var d=f.next();if(d=="{"||d=="}"||d=="["||d=="]"||d=="("||d==")"){return"bracket"}if(d=="%"){f.skipToEnd();return"comment"}return"error"}function o(e,f){var c=e.peek(),d;if(c=="{"||c=="["){d=n(f);d.openBracket(c);e.eat(c);q(f,p);return"bracket"}if(/[ \t\r]/.test(c)){e.eat(c);return null}q(f,p);a(f);return p(e,f)}return{startState:function(){return{cmdState:[],f:p}},copyState:function(c){return{cmdState:c.cmdState.slice(),f:c.f}},token:function(c,d){return d.f(c,d)},blankLine:function(c){c.f=p;c.cmdState.length=0},lineComment:"%"}});b.defineMIME("text/x-stex","stex");b.defineMIME("text/x-latex","stex")});