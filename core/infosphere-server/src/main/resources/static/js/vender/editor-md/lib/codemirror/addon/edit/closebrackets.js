(function(a){if(typeof exports=="object"&&typeof module=="object"){a(require("../../lib/codemirror"))}else{if(typeof define=="function"&&define.amd){define(["../../lib/codemirror"],a)}else{a(CodeMirror)}}})(function(d){var i="()[]{}''\"\"";var a="'\"";var h="[]{}";var j=/\s/;var g=d.Pos;d.defineOption("autoCloseBrackets",false,function(k,p,l){if(l!=d.Init&&l){k.removeKeyMap("autoCloseBrackets")}if(!p){return}var n=i,q=a,m=h;if(typeof p=="string"){n=p}else{if(typeof p=="object"){if(p.pairs!=null){n=p.pairs}if(p.triples!=null){q=p.triples}if(p.explode!=null){m=p.explode}}}var o=c(n,q);if(m){o.Enter=b(m)}k.addKeyMap(o)});function e(k,m){var l=k.getRange(g(m.line,m.ch-1),g(m.line,m.ch+1));return l.length==2?l:null}function f(k,q,o){var l=k.getLine(q.line);var n=k.getTokenAt(q);if(/\bstring2?\b/.test(n.type)){return false}var p=new d.StringStream(l.slice(0,q.ch)+o+l.slice(q.ch),4);p.pos=p.start=n.start;for(;;){var m=k.getMode().token(p,n.state);if(p.pos>=q.ch+1){return/\bstring2?\b/.test(m)}p.start=p.pos}}function c(m,o){var n={name:"autoCloseBrackets",Backspace:function(p){if(p.getOption("disableInput")){return d.Pass}var q=p.listSelections();for(var r=0;r<q.length;r++){if(!q[r].empty()){return d.Pass}var s=e(p,q[r].head);if(!s||m.indexOf(s)%2!=0){return d.Pass}}for(var r=q.length-1;r>=0;r--){var t=q[r].head;p.replaceRange("",g(t.line,t.ch-1),g(t.line,t.ch+1))}}};var l="";for(var k=0;k<m.length;k+=2){(function(q,p){l+=p;n["'"+q+"'"]=function(r){if(r.getOption("disableInput")){return d.Pass}var s=r.listSelections(),x,w;for(var v=0;v<s.length;v++){var t=s[v],y=t.head,u;var w=r.getRange(y,g(y.line,y.ch+1));if(!t.empty()){u="surround"}else{if(q==p&&w==p){if(r.getRange(y,g(y.line,y.ch+3))==q+q+q){u="skipThree"}else{u="skip"}}else{if(q==p&&y.ch>1&&o.indexOf(q)>=0&&r.getRange(g(y.line,y.ch-2),y)==q+q&&(y.ch<=2||r.getRange(g(y.line,y.ch-3),g(y.line,y.ch-2))!=q)){u="addFour"}else{if(q=='"'||q=="'"){if(!d.isWordChar(w)&&f(r,y,q)){u="both"}else{return d.Pass}}else{if(r.getLine(y.line).length==y.ch||l.indexOf(w)>=0||j.test(w)){u="both"}else{return d.Pass}}}}}if(!x){x=u}else{if(x!=u){return d.Pass}}}r.operation(function(){if(x=="skip"){r.execCommand("goCharRight")}else{if(x=="skipThree"){for(var A=0;A<3;A++){r.execCommand("goCharRight")}}else{if(x=="surround"){var z=r.getSelections();for(var A=0;A<z.length;A++){z[A]=q+z[A]+p}r.replaceSelections(z,"around")}else{if(x=="both"){r.replaceSelection(q+p,null);r.execCommand("goCharLeft")}else{if(x=="addFour"){r.replaceSelection(q+q+q+q,"before");r.execCommand("goCharRight")}}}}}})};if(q!=p){n["'"+p+"'"]=function(r){var s=r.listSelections();for(var u=0;u<s.length;u++){var t=s[u];if(!t.empty()||r.getRange(t.head,g(t.head.line,t.head.ch+1))!=p){return d.Pass}}r.execCommand("goCharRight")}}})(m.charAt(k),m.charAt(k+1))}return n}function b(k){return function(l){if(l.getOption("disableInput")){return d.Pass}var m=l.listSelections();for(var n=0;n<m.length;n++){if(!m[n].empty()){return d.Pass}var o=e(l,m[n].head);if(!o||k.indexOf(o)%2!=0){return d.Pass}}l.operation(function(){l.replaceSelection("\n\n",null);l.execCommand("goCharLeft");m=l.listSelections();for(var q=0;q<m.length;q++){var p=m[q].head.line;l.indentLine(p,null,true);l.indentLine(p+1,null,true)}})}}});