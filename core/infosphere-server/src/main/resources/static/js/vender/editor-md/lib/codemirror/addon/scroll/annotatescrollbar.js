(function(a){if(typeof exports=="object"&&typeof module=="object"){a(require("../../lib/codemirror"))}else{if(typeof define=="function"&&define.amd){define(["../../lib/codemirror"],a)}else{a(CodeMirror)}}})(function(a){a.defineExtension("annotateScrollbar",function(c){if(typeof c=="string"){c={className:c}}return new b(this,c)});a.defineOption("scrollButtonHeight",0);function b(c,e){this.cm=c;this.options=e;this.buttonHeight=e.scrollButtonHeight||c.getOption("scrollButtonHeight");this.annotations=[];this.doRedraw=this.doUpdate=null;this.div=c.getWrapperElement().appendChild(document.createElement("div"));this.div.style.cssText="position: absolute; right: 0; top: 0; z-index: 7; pointer-events: none";this.computeScale();function f(g){clearTimeout(d.doRedraw);d.doRedraw=setTimeout(function(){d.redraw()},g)}var d=this;c.on("refresh",this.resizeHandler=function(){clearTimeout(d.doUpdate);d.doUpdate=setTimeout(function(){if(d.computeScale()){f(20)}},100)});c.on("markerAdded",this.resizeHandler);c.on("markerCleared",this.resizeHandler);if(e.listenForChanges!==false){c.on("change",this.changeHandler=function(){f(250)})}}b.prototype.computeScale=function(){var c=this.cm;var d=(c.getWrapperElement().clientHeight-c.display.barHeight-this.buttonHeight*2)/c.heightAtLine(c.lastLine()+1,"local");if(d!=this.hScale){this.hScale=d;return true}};b.prototype.update=function(c){this.annotations=c;this.redraw()};b.prototype.redraw=function(k){if(k!==false){this.computeScale()}var l=this.cm,o=this.hScale;var n=document.createDocumentFragment(),f=this.annotations;if(l.display.barWidth){for(var g=0,h;g<f.length;g++){var d=f[g];var j=h||l.charCoords(d.from,"local").top*o;var c=l.charCoords(d.to,"local").bottom*o;while(g<f.length-1){h=l.charCoords(f[g+1].from,"local").top*o;if(h>c+0.9){break}d=f[++g];c=l.charCoords(d.to,"local").bottom*o}if(c==j){continue}var m=Math.max(c-j,3);var e=n.appendChild(document.createElement("div"));e.style.cssText="position: absolute; right: 0px; width: "+Math.max(l.display.barWidth-1,2)+"px; top: "+(j+this.buttonHeight)+"px; height: "+m+"px";e.className=this.options.className}}this.div.textContent="";this.div.appendChild(n)};b.prototype.clear=function(){this.cm.off("refresh",this.resizeHandler);this.cm.off("markerAdded",this.resizeHandler);this.cm.off("markerCleared",this.resizeHandler);if(this.changeHandler){this.cm.off("change",this.changeHandler)}this.div.parentNode.removeChild(this.div)}});